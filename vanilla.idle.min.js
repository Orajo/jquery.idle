(function(){"use strict";window.idle=function(options){let defaults={idle:6e4,preIdle:3e4,events:["mousemove","keydown","mousedown","touchstart"],onIdle:function(){},onPreIdle:function(){},onActive:function(){},onHide:function(){},onShow:function(){},keepTracking:true,startAtIdle:false,recurIdleCall:false};let settings=extend({},defaults,options);let idle=settings.startAtIdle;let preIdle=false;let visible=!settings.startAtIdle;let visibilityEvents=["visibilitychange","webkitvisibilitychange","mozvisibilitychange","msvisibilitychange"];let lastId=null;let resetTimeout,timeout,preIdleTimer;let lastPreId=null;window.addEventListener("idle:stop",function(event){bulkRemoveEventListener(window,settings.events);settings.keepTracking=false;resetTimeout(lastId,lastPreId,settings)});resetTimeout=function resetTimeout(id,preId,settings){if(idle||preId){idle=preIdle=false;settings.onActive.call()}clearTimeout(id);clearTimeout(preId);if(settings.keepTracking){lastPreId=preIdleTimer(settings);return timeout(settings)}};timeout=function timeout(settings){let timer=settings.recurIdleCall?setInterval:setTimeout;let id;id=timer(function(){idle=true;settings.onIdle.call()},settings.idle);return id};preIdleTimer=function pretimeout(settings){let timer=settings.recurIdleCall?setInterval:setTimeout;let id;id=timer(function(){preIdle=true;settings.onPreIdle.call(this,settings.preIdle,settings.idle)},settings.idle);return id};return{start:function(){lastId=timeout(settings);lastPreId=preIdleTimer(settings);bulkAddEventListener(window,settings.events,function(event){lastId=resetTimeout(lastId,lastPreId,settings)});if(settings.onShow||settings.onHide){bulkAddEventListener(document,visibilityEvents,function(event){if(document.hidden||document.webkitHidden||document.mozHidden||document.msHidden){if(visible){visible=false;settings.onHide.call()}}else{if(!visible){visible=true;settings.onShow.call()}}})}}}};let bulkAddEventListener=function bulkAddEventListener(object,events,callback){events.forEach(function(event){object.addEventListener(event,function(event){callback(event)})})};let bulkRemoveEventListener=function bulkRemoveEventListener(object,events){events.forEach(function(event){object.removeEventListener(event)})};let extend=function extend(out){out=out||{};for(let i=1;i<arguments.length;i++){if(!arguments[i]){continue}for(let key in arguments[i]){if(arguments[i].hasOwnProperty(key)){out[key]=arguments[i][key]}}}return out}})();