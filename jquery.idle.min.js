(function($){"use strict";$.fn.idle=function(options){let defaults={idle:6e4,preIdle:3e4,events:"mousemove keydown mousedown touchstart",onIdle:function(){},onPreIdle:function(){},onActive:function(){},onHide:function(){},onShow:function(){},keepTracking:true,startAtIdle:false,recurIdleCall:false},idle=options.startAtIdle||false,preIdle=false,visible=!options.startAtIdle||true,settings=$.extend({},defaults,options),lastId=null,lastPreId=null,resetTimeout,timeout,preIdleTimer;$(this).on("idle:stop",{},function(event){$(this).off(settings.events);settings.keepTracking=false;resetTimeout(lastId,lastPreId,settings)});resetTimeout=function(id,preId,settings){if(idle||preId){idle=preIdle=false;settings.onActive.call()}clearTimeout(id);clearTimeout(preId);if(settings.keepTracking){lastPreId=preIdleTimer(settings);return timeout(settings)}};timeout=function(settings){let timer=settings.recurIdleCall?setInterval:setTimeout,id;id=timer(function(){idle=true;settings.onIdle.call(this,settings.idle)},settings.idle);return id};preIdleTimer=function(settings){let timer=settings.recurIdleCall?setInterval:setTimeout,id;id=timer(function(){preIdle=true;settings.onPreIdle.call(this,settings.preIdle,settings.idle)},settings.preIdle);return id};return this.each(function(){lastId=timeout(settings);lastPreId=preIdleTimer(settings);$(this).on(settings.events,function(e){lastId=resetTimeout(lastId,lastPreId,settings)});if(settings.onShow||settings.onHide){$(document).on("visibilitychange webkitvisibilitychange mozvisibilitychange msvisibilitychange",function(){if(document.hidden||document.webkitHidden||document.mozHidden||document.msHidden){if(visible){visible=false;settings.onHide.call()}}else{if(!visible){visible=true;settings.onShow.call()}}})}})}})(jQuery);